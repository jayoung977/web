<!DOCTYPE html>
<html lang="ko">
  <%- include('include/include', { title: '회원 정보' })%>
  <body>
    <h1>회원 정보</h1>
    <a href="/user">HOME</a>
    <p>ID 수정 불가능, Password, Name 수정 가능</p>
    <form name="form_profile">
      <label for="userid">ID</label>
      <input type="hidden" id="id" value="<%= data.id %>" />
      <!-- readonly: userid는 수정 불가능 (조건임) -->
      <input
        id="userid"
        type="text"
        name="userid"
        value="<%= data.userid %>"
        readonly
      /><br />
      <label for="password">Password</label>
      <input
        id="password"
        type="password"
        name="pw"
        value="<%= data.pw %>"
        required
      /><br />
      <label for="name">Name</label>
      <input
        id="name"
        type="text"
        name="name"
        value="<%= data.name %>"
        required
      /><br />
      <button type="button" onclick="profileEdit();">Edit</button>
      <button type="button" onclick="profileDelete(`<%=data.id %>`);">
        Delete
      </button>
    </form>

    <script>
      // console.log(data);
      //(3)-3 POST /user/profile/edit 회원 정보 수정
      // TODO: [Login] 버튼 클릭시 서버에 회원 정보 수정 요청하기
      // POST /user/profile/edit

      function profileEdit() {
        const form = document.forms["form_profile"];
        axios({
          method: "POST",
          url: "/user/profile/edit",
          data: {
            id: form.id.value,
            userid: form.userid.value,
            pw: form.pw.value,
            name: form.name.value,
          },
        }).then((res) => {
          console.log(res.data);
          alert(res.data);
          document.querySelector("#userid").textContent = form.userid.value;
          document.querySelector("#password").textContent = form.pw.value;
          document.querySelector("#name").textContent = form.name.value;
        });
      }

      //(3)-4 POST /user/profile/delete 회원 정보 제거
      // TODO: [Login] 버튼 클릭시 서버에 회원 정보 삭제 요청하기
      // POST /user/profile/delete
      function profileDelete(id) {
        console.log("id", id);
        if (!confirm("정말 삭제하시겠습니까?")) {
          return;
        }
        // confirm에서 [확인] 버튼 클릭 시 실행할 코드
        axios({
          method: "POST",
          url: "/user/profile/delete",
          data: {
            id: id, //매개변수로 받고 있는 id
          },
        }).then((res) => {
          console.log(res.data); //삭제 성공!!
          document.location.href = "/user";

          //삭제하는 다른 방법
          //obj.parentElement.parentElement.remove();
          //obj.closest(`#tr_${id}`).remove(); //가장 가까운 선택자 찾아감
        });
      }
    </script>
  </body>
</html>
